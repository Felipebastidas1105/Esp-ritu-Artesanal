---
import Layout from "../layouts/Layout.astro";
// Importo imágenes locales desde src/assets para los paneles
import ProductCard from "../components/ProductCard.astro";
import { getAllProducts } from "../services/productService";
import imgphoto from "../assets/06.jpg";

// Datos dinámicos a través del servicio para facilitar mantenibilidad
const products = getAllProducts();
const instagram = "https://www.instagram.com/espiritu.artesano/";
---

<Layout>

  <!-- Header minimal y moderno -->
  <header class="hidden">
    <div class="max-w-7xl mx-auto px-6 py-4 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="w-12 h-12 bg-gradient-to-br from-amber-600 to-orange-500 rounded-2xl flex items-center justify-center text-white font-bold shadow-lg">
          <img src="favicon.jpg" alt="Logo Espíritu Artesano" class="w-full h-full object-contain" />
        </div>
        <div>
          <h1 class="text-2xl font-bold text-amber-900 font-playfair">Espíritu Artesano</h1>
          <p class="text-xs text-amber-700">Accesorios únicos • Hechos con paciencia y amor</p>
        </div>
      </div>

      <nav class="hidden md:flex gap-8 text-sm font-medium">
        <a href="#inicio" class="text-amber-900 hover:text-orange-600 transition-colors">Inicio</a>
        <a href="#galeria" class="text-amber-900 hover:text-orange-600 transition-colors">Galería</a>
        <a href="#nosotros" class="text-amber-900 hover:text-orange-600 transition-colors">Nosotros</a>
        <a href="#contacto" class="text-amber-900 hover:text-orange-600 transition-colors">Contacto</a>
      </nav>
    </div>
  </header>

  <main class="overflow-x-hidden bg-[#F5E6D3]">
    <!-- Hero -->
    <section id="inicio" class="relative min-h-screen flex items-center justify-center pt-24">
      <!-- Sutil textura y blobs -->
      <div class="absolute inset-0 opacity-5">
        <div class="absolute inset-0" style="background-image: radial-gradient(circle, #d97706 1px, transparent 1px); background-size: 40px 40px"></div>
      </div>
      <div class="absolute top-20 left-10 w-72 h-72 bg-orange-200/30 rounded-full blur-3xl"></div>
      <div class="absolute bottom-20 right-10 w-96 h-96 bg-amber-200/30 rounded-full blur-3xl"></div>

      <div class="relative max-w-6xl mx-auto px-6 text-center z-10">
        <div class="inline-block mb-6 px-6 py-2 bg-white/80 backdrop-blur-sm text-orange-700 rounded-full text-sm font-semibold shadow-lg reveal-v">
          ✨ Accesorios únicos 
        </div>
        <h2 class="text-6xl md:text-8xl font-bold text-amber-900 mb-8 font-playfair reveal-v">Espíritu Artesano</h2>
        <p class="text-2xl md:text-3xl text-amber-800 mb-6 max-w-3xl mx-auto font-light reveal-v">Accesorios artesanales en chaquira: aretes, collares y pulseras</p>
        <p class="text-lg md:text-xl text-amber-700 mb-12 max-w-2xl mx-auto leading-relaxed reveal-v">Encuentra aquí los accesorios únicos que hemos diseñados para ti.</p>

        <div class="flex flex-col sm:flex-row gap-6 justify-center reveal-v">
          <a href="#galeria" class="inline-flex items-center justify-center px-10 py-5 bg-gradient-to-r from-amber-600 to-orange-600 text-white rounded-2xl font-semibold shadow-xl hover:shadow-2xl transform hover:-translate-y-1 transition-all">Ver Galería</a>
          <a href="#nosotros" class="inline-flex items-center justify-center px-10 py-5 bg-white/80 backdrop-blur-sm text-amber-900 rounded-2xl font-semibold border-2 border-amber-300 hover:border-amber-500 hover:bg-white transition-all shadow-lg">Nuestra Historia</a>
        </div>
      </div>
    </section>

    <!-- Sección con ilusión de scroll horizontal -->
    <!--
      Idea clave:
      - El scroll vertical "pinnea" este contenedor y desplaza el track horizontal.
      - Así se siente como si la página se moviera a la derecha/izquierda.
    -->
    <section id="galeria" class="relative py-12 md:py-20">
      <div class="pin-wrap min-h-[70vh] md:min-h-[80vh] flex items-center justify-start overflow-hidden">
        <!-- Track horizontal (contenido en filas) -->
        <div class="horizontal-track relative flex flex-col md:flex-row gap-8 md:gap-12 px-4 md:px-6 w-full md:w-max">
          {products.slice(0, 5).map((card) => (
            <article class="panel min-w-full md:min-w-[70vw] lg:min-w-[55vw] h-auto md:h-[50vh] relative reveal">
              <div class="grid grid-cols-1 md:grid-cols-12 gap-8 items-center p-4 md:p-6 bg-white/40 backdrop-blur-md rounded-3xl shadow-soft">
                <div class="md:col-span-5">
                  <div class="img-wrap w-full h-[28vh] md:h-[36vh]  rounded-2xl overflow-hidden flex items-center justify-center">
                    <img src={card.image.src} alt={card.alt} class="parallax-img w-full h-full object-contain" />
                  </div>
                </div>
                <div class="md:col-span-7">
                  <h3 class="heading text-3xl md:text-5xl font-bold font-playfair text-[#C9A961]">{card.title}</h3>
                  <div class="mt-3 w-24 h-1.5 bg-[#C9A961] rounded-full"></div>
                  <p class="copy mt-4 md:mt-5 text-base md:text-lg text-[#8B6B47]">{card.description}</p>
                </div>
              </div>
            </article>
          ))}
          <!-- Panel final con CTA para ver productos -->
          <article class="panel min-w-full md:min-w-[70vw] lg:min-w-[55vw] h-auto md:h-[50vh] relative reveal">
            <div class="grid grid-cols-1 items-center p-6 bg-white/40 backdrop-blur-md rounded-3xl shadow-soft">
              <div class="flex items-center justify-center">
                <a href="/productos" class="inline-flex items-center justify-center px-10 py-5 bg-gradient-to-r from-amber-600 to-orange-600 text-white rounded-2xl font-semibold shadow-xl hover:shadow-2xl transform hover:-translate-y-1 transition-all">
                  Ver productos
                </a>
              </div>
            </div>
          </article>
        </div>
      </div>
    </section>

    <!-- Sección de productos con filtros -->
    <section id="productos" class="py-24 px-6 bg-white hidden">
      <div class="max-w-7xl mx-auto">
        <h3 class="text-4xl md:text-5xl font-bold text-amber-900 font-playfair mb-6 reveal-v">Productos</h3>
        <div class="w-32 h-1.5 bg-gradient-to-r from-amber-600 to-orange-600 rounded-full mb-8"></div>
        <!-- Filtros -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
          <input id="filter-name" type="text" placeholder="Buscar por nombre" class="px-4 py-3 rounded-xl border-2 border-amber-200 focus:border-amber-500 outline-none bg-white/80" />
          <select id="filter-category" class="px-4 py-3 rounded-xl border-2 border-amber-200 focus:border-amber-500 outline-none bg-white/80">
            <option value="Todas">Todas las categorías</option>
            {Array.from(new Set(products.map((c) => c.category))).map((cat) => (
              <option value={cat}>{cat}</option>
            ))}
          </select>
          <input id="filter-min-price" type="number" min="0" placeholder="Precio mínimo" class="px-4 py-3 rounded-xl border-2 border-amber-200 focus:border-amber-500 outline-none bg-white/80" />
          <input id="filter-max-price" type="number" min="0" placeholder="Precio máximo" class="px-4 py-3 rounded-xl border-2 border-amber-200 focus:border-amber-500 outline-none bg-white/80" />
        </div>

        <!-- Grid de productos -->
        <!-- <div id="productsGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
          {products.map((p) => (
            <ProductCard product={p} />
          ))}
        </div> -->
      </div>
    </section>

    <!-- Sección vertical adicional -->
    <section id="nosotros" class="py-24 px-6 bg-white relative">
      <div class="max-w-6xl mx-auto">
        <div class="grid md:grid-cols-2 gap-16 items-center">
          <div class="space-y-6">
            <h3 class="text-5xl md:text-6xl font-bold text-amber-900 font-playfair reveal-v">Cuidado en cada detalle</h3>
            <p class="text-xl text-amber-800 leading-relaxed reveal-v">Creamos accesorios artesanales, hechos a mano con detalle y cariño.</p>
          </div>
          <div class="rounded-3xl aspect-square flex items-center justify-center text-8xl reveal-v">
            <img src={imgphoto.src} alt="Foto de Espíritu Artesano" class="w-full h-full object-contain " />
          </div>
        </div>
      </div>
    </section>

    <section id="contacto" class="py-24 px-6 bg-gradient-to-br from-amber-50 to-orange-50">
      <div class="max-w-5xl mx-auto text-center">
        <h3 class="text-5xl md:text-6xl font-bold text-amber-900 font-playfair mb-6 reveal-v">¡Conecta con Espíritu Artesano!</h3>
        <div class="w-32 h-1.5 bg-gradient-to-r from-amber-600 to-orange-600 mx-auto rounded-full mb-8"></div>
        <p class="text-xl text-amber-800 mb-8 max-w-2xl mx-auto reveal-v">Escríbenos para piezas personalizadas, pedidos y colaboraciones.</p>
        <a href={instagram} target="_blank" class="inline-flex items-center justify-center px-10 py-5 bg-gradient-to-r from-amber-600 to-orange-600 text-white rounded-2xl font-semibold shadow-xl hover:shadow-2xl transform hover:-translate-y-1 transition-all">Contactar</a>
      </div>
    </section>

    <footer class="bg-gradient-to-br from-amber-900 to-orange-900 text-amber-100 py-16 px-6">
      <div class="max-w-7xl mx-auto text-center">
        <h4 class="text-3xl font-bold mb-2 font-playfair">Espíritu Artesano</h4>
        <p class="text-lg">Hecho a mano con amor ✨</p>
        <div class="mt-6 border-t border-amber-700/50 pt-6 text-sm">© 2025 Espíritu Artesano. Todos los derechos reservados.</div>
      </div>
    </footer>
  </main>

  <!--
    Script del efecto (GSAP + ScrollTrigger):
    - Pin del contenedor y desplazamiento del track horizontal.
    - Animaciones suaves al aparecer (fade/slide/scale) con ScrollTrigger.
  -->
  <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.2/dist/gsap.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.2/dist/ScrollTrigger.min.js" defer></script>

  <script>
    const { gsap , ScrollTrigger } = window as any;
    if (gsap && ScrollTrigger) {
      gsap.registerPlugin(ScrollTrigger);

      // Responsive: horizontal (pin) en desktop y stack vertical en móviles
      ScrollTrigger.matchMedia({
        "(min-width: 768px)": function () {
          const track = document.querySelector(".horizontal-track");
          const pinWrap = document.querySelector(".pin-wrap");

          if (track && pinWrap) {
            const totalScroll = () => track.scrollWidth - window.innerWidth;
            const horizontalTween = gsap.to(track, {
              x: () => -totalScroll(),
              ease: "none",
              scrollTrigger: {
                trigger: pinWrap,
                start: "top top",
                end: () => "+=" + totalScroll(),
                pin: true,
                scrub: 0.5,
                anticipatePin: 1,
                invalidateOnRefresh: true,
              },
            });

            // Aparición de paneles alineados al scroll horizontal
            gsap.utils.toArray(".reveal").forEach((el : any) => {
              gsap.from(el, {
                opacity: 0,
                y: 30,
                scale: 0.98,
                duration: 0.8,
                ease: "power2.out",
                scrollTrigger: {
                  trigger: el,
                  containerAnimation: horizontalTween,
                  start: "left 85%",
                  toggleActions: "play none none reverse",
                },
              });
            });

            // Parallax vertical suave para imágenes (evita desbordes horizontales)
            gsap.utils.toArray(".parallax-img").forEach((img : any) => {
              gsap.fromTo(
                img,
                { y: -20, scale: 1.0, opacity: 0 },
                {
                  y: 20,
                  scale: 1.0,
                  opacity: 1,
                  duration: 0.8,
                  ease: "power2.out",
                  scrollTrigger: {
                    trigger: img,
                    containerAnimation: horizontalTween,
                    start: "left 80%",
                    toggleActions: "play none none reverse",
                  },
                }
              );
            });

            // Títulos y copys con contramovimiento sutil
            gsap.utils.toArray(".panel .heading").forEach((el: any) => {
              gsap.from(el, {
                opacity: 0,
                x: -40,
                duration: 0.7,
                ease: "power2.out",
                scrollTrigger: {
                  trigger: el,
                  containerAnimation: horizontalTween,
                  start: "left 85%",
                  toggleActions: "play none none reverse",
                },
              });
            });
            gsap.utils.toArray(".panel .copy").forEach((el : any) => {
              gsap.from(el, {
                opacity: 0,
                x: 40,
                duration: 0.7,
                ease: "power2.out",
                scrollTrigger: {
                  trigger: el,
                  containerAnimation: horizontalTween,
                  start: "left 85%",
                  toggleActions: "play none none reverse",
                },
              });
            });
          }
        },
        "(max-width: 767px)": function () {
          // Apilado vertical sin pin; apariciones suaves
          gsap.set(".horizontal-track", { clearProps: "x" });
          gsap.utils.toArray(".reveal").forEach((el : any) => {
            gsap.from(el, {
              opacity: 0,
              y: 24,
              duration: 0.7,
              ease: "power2.out",
              scrollTrigger: {
                trigger: el,
                start: "top 85%",
                toggleActions: "play none none reverse",
              },
            });
          });
          gsap.utils.toArray(".parallax-img").forEach((img : any) => {
            gsap.from(img, {
              opacity: 0,
              y: 20,
              scale: 1.02,
              duration: 0.7,
              ease: "power2.out",
              scrollTrigger: {
                trigger: img,
                start: "top 85%",
                toggleActions: "play none none reverse",
              },
            });
          });
        },
      });

      // 3) Aparición suave en secciones verticales
      gsap.utils.toArray(".reveal-v").forEach((el : any) => {
        gsap.from(el, {
          opacity: 0,
          y: 30,
          duration: 0.8,
          ease: "power2.out",
          scrollTrigger: {
            trigger: el,
            start: "top 85%",
            toggleActions: "play none none reverse",
          },
        });
      });
    }

    // Mostrar sección de productos al hacer click
    const btn = document.getElementById("verProductosBtn");
    const productosSection = document.getElementById("productos");
    btn?.addEventListener("click", () => {
      productosSection?.classList.remove("hidden");
      productosSection?.scrollIntoView({ behavior: "smooth" });
    });

    // Filtrado por nombre, categoría y precio
    const nameInput = document.getElementById("filter-name") as HTMLInputElement | null;
    const categorySelect = document.getElementById("filter-category") as HTMLSelectElement | null;
    const minInput = document.getElementById("filter-min-price") as HTMLInputElement | null;
    const maxInput = document.getElementById("filter-max-price") as HTMLInputElement | null;

    function applyFilters() {
      const name = (nameInput?.value || "").toLowerCase().trim();
      const cat = categorySelect?.value || "Todas";
      const min = parseFloat(minInput?.value || "0");
      const max = parseFloat(maxInput?.value || `${Number.MAX_VALUE}`);

      document.querySelectorAll<HTMLElement>(".product-card").forEach((el) => {
        const n = (el.dataset.name || "").toLowerCase();
        const c = el.dataset.category || "";
        const p = parseFloat(el.dataset.price || "0");
        const matchesName = !name || n.includes(name);
        const matchesCategory = !cat || cat === "Todas" || c === cat;
        const matchesPrice = p >= (isNaN(min) ? 0 : min) && p <= (isNaN(max) ? Number.MAX_VALUE : max);
        el.classList.toggle("hidden", !(matchesName && matchesCategory && matchesPrice));
      });
    }

    ["input", "change"].forEach((evt) => {
      nameInput?.addEventListener(evt, applyFilters);
      categorySelect?.addEventListener(evt, applyFilters);
      minInput?.addEventListener(evt, applyFilters);
      maxInput?.addEventListener(evt, applyFilters);
    });
  </script>
</Layout>